
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // APP SETTINGS
    // Stores global application settings like active match IDs.
    // Production: Restrict write access to admin/trusted server. Read access might be public or restricted.
    match /app_settings/{settingId} {
      allow read: if request.auth != null; // Or if true; for public read during dev
      allow write: if request.auth != null; // TODO: Restrict to Admin in production (e.g., request.auth.token.isAdmin == true)
    }

    // SCHEDULES (Tanding & TGR)
    // Stores match schedules. Created and managed by Admin.
    // Production: Write access should be strictly Admin-only. Read access might be public for users to view schedules.
    match /schedules_tanding/{scheduleId} {
      allow read: if request.auth != null; // Or if true; for public read during dev
      allow write: if request.auth != null; // TODO: Restrict to Admin in production (e.g., request.auth.token.isAdmin == true)
    }
    match /schedules_tgr/{scheduleId} {
      allow read: if request.auth != null; // Or if true; for public read during dev
      allow write: if request.auth != null; // TODO: Restrict to Admin in production (e.g., request.auth.token.isAdmin == true)
    }

    // LIVE MATCH DATA (TANDING)
    // Stores live scoring data for Tanding matches.
    // Production:
    //   - Overall match document: Write access for Dewan/Timer for timer_status. Read access for Juri, Ketua, Monitor.
    //   - juri_scores: Juri can only write to their own document. Dewan/Ketua might read all.
    //   - official_actions: Only Ketua Pertandingan can write.
    //   - verifications: Ketua creates, Juri update their votes, Dewan/Ketua update status/result.
    match /matches_tanding/{matchId} {
      allow read, write: if request.auth != null; // TODO: Granular rules for production.

      match /juri_scores/{juriId} {
        allow read, write: if request.auth != null; // TODO: Restrict write to specific Juri (e.g., request.auth.uid == juriId or custom claim)
      }

      match /official_actions/{actionId} {
        allow read, write: if request.auth != null; // TODO: Restrict write to Ketua Pertandingan
      }

      match /verifications/{verificationId} {
        allow read, write: if request.auth != null; // TODO: Granular rules for creation, voting, and completion.
      }
    }

    // LIVE MATCH DATA (TGR)
    // Stores live scoring data for TGR matches.
    // Production:
    //   - Overall match document: Write access for Dewan/Timer for timer_status. Read access for Juri, Ketua, Monitor.
    //   - juri_scores_tgr: Juri can only write to their own document. Ketua might read all.
    //   - dewan_penalties_tgr: Only Dewan can write.
    match /matches_tgr/{matchId} {
      allow read, write: if request.auth != null; // TODO: Granular rules for production.

      match /juri_scores_tgr/{juriId} {
        allow read, write: if request.auth != null; // TODO: Restrict write to specific Juri
      }

      match /dewan_penalties_tgr/{penaltyId} {
        allow read, write: if request.auth != null; // TODO: Restrict write to Dewan
      }
    }

    // Default rule (optional, can be removed if all paths are covered above)
    // Consider a default deny if you want to be explicit.
    // match /{document=**} {
    //   allow read, write: if false;
    // }
  }
}
