rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- PENGATURAN UMUM APLIKASI ---
    // Mengizinkan baca dan tulis untuk semua dokumen di app_settings.
    // Ini digunakan untuk active_match_tanding dan active_match_tgr.
    // Untuk produksi, batasi 'write' hanya untuk admin.
    match /app_settings/{settingId} {
      allow read: if true;
      allow write: if true; // PERHATIAN: Sangat permisif, amankan untuk produksi!
                           // Contoh aman: allow write: if request.auth != null && get(/databases/$(database)/documents/admins/$(request.auth.uid)).exists;
    }

    // --- JADWAL PERTANDINGAN (TANDING & TGR) ---
    // Mengizinkan baca dan tulis untuk semua jadwal.
    // Untuk produksi, batasi 'write' hanya untuk admin.
    match /schedules_tanding/{scheduleId} {
      allow read: if true;
      allow write: if true; // PERHATIAN: Amankan untuk produksi!
    }

    match /schedules_tgr/{scheduleId} {
      allow read: if true;
      allow write: if true; // PERHATIAN: Amankan untuk produksi!
    }

    // --- DATA PERTANDINGAN TANDING ---
    // Aturan untuk dokumen utama pertandingan Tanding dan sub-koleksinya.
    match /matches_tanding/{matchId} {
      // Dokumen utama (timer, log skor terkonfirmasi)
      allow read: if true;  // Diperlukan oleh semua peran Tanding (Dewan, Ketua, Juri, Monitor)
      allow write: if true; // PERHATIAN: Dewan/Ketua yang memodifikasi ini. Amankan untuk produksi!

      // Skor dari masing-masing Juri Tanding
      match /juri_scores/{juriId} {
        allow read: if true;
        allow write: if true; // PERHATIAN: Juri Tanding menulis di sini. Amankan untuk produksi!
                              // Contoh: allow write: if request.auth != null; (minimal)
      }

      // Log tindakan dari Ketua Pertandingan Tanding
      match /official_actions/{actionId} {
        allow read: if true;
        allow write: if true; // PERHATIAN: Ketua Pertandingan Tanding menulis di sini. Amankan!
      }

      // Data verifikasi yang diminta Ketua Pertandingan Tanding
      match /verifications/{verificationId} {
        allow read: if true;
        allow write: if true; // PERHATIAN: Ketua Pertandingan Tanding membuat/memperbarui. Amankan!
      }
    }

    // --- DATA PERTANDINGAN TGR ---
    // Aturan untuk dokumen utama pertandingan TGR dan sub-koleksinya.
    match /matches_tgr/{matchId} {
      // Dokumen utama (timer status TGR)
      allow read: if true;  // Diperlukan oleh Juri TGR untuk status timer, dan Ketua TGR.
      allow write: if true; // PERHATIAN: Dewan TGR/Ketua TGR yang memodifikasi ini. Amankan untuk produksi!

      // Skor dari masing-masing Juri TGR
      match /juri_scores_tgr/{juriId} {
        allow read: if true;  // Ketua TGR atau monitor mungkin perlu membaca ini.
        allow write: if true; // PERHATIAN: Juri TGR menulis di sini. Amankan untuk produksi!
                              // Contoh: allow write: if request.auth != null; (minimal)
      }

      // Sub-koleksi lain untuk TGR, jika ada (misalnya, hukuman dari Dewan TGR)
      // match /dewan_penalties_tgr/{penaltyId} {
      //   allow read: if true;
      //   allow write: if true; // PERHATIAN: Idealnya dibatasi hanya untuk Dewan TGR.
      // }
    }
    // --- AKHIR ATURAN TGR ---
  }
}