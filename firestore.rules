
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // App Settings (active match configuration)
    // In production, only admins should write here.
    // For development, allow authenticated users.
    match /app_settings/{settingId} {
      allow read, write: if request.auth != null;
    }

    // Schedules (Tanding & TGR)
    // In production, typically managed by Admins.
    // For development, allow authenticated users.
    match /schedules_tanding/{scheduleId} {
      allow read, write: if request.auth != null;
    }
    match /schedules_tgr/{scheduleId} {
      allow read, write: if request.auth != null;
    }

    // Live Match Data (Tanding)
    match /matches_tanding/{matchId} {
      // Allow read/write to the main match document (timer, logs, etc.)
      allow read, write: if request.auth != null;

      // Juri Scores for Tanding
      // In production, a Juri should ideally only write to their own document.
      match /juri_scores/{juriId} {
        allow read, write: if request.auth != null;
      }

      // Official Actions (Ketua Pertandingan actions)
      match /official_actions/{actionId} {
        allow read, write: if request.auth != null;
      }

      // Verifications
      match /verifications/{verificationId} {
        allow read, write: if request.auth != null;
      }
    }

    // Live Match Data (TGR)
    match /matches_tgr/{matchId} {
      // Allow read/write to the main match document (timer, etc.)
      allow read, write: if request.auth != null;

      // Juri Scores for TGR
      match /juri_scores_tgr/{juriId} {
        allow read, write: if request.auth != null;
      }

      // Dewan Penalties for TGR
      match /dewan_penalties_tgr/{penaltyId} {
        allow read, write: if request.auth != null;
      }
    }

    // Fallback: Deny all other paths if not explicitly matched.
    // If you have other collections, you'll need to add rules for them.
    // For a fresh project with only the above, this rule is not strictly
    // necessary as unmatched paths are denied by default.
    // However, it's a good explicit statement.
    // match /{document=**} {
    //   allow read, write: if false;
    // }
  }
}
