
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // App Settings:
    // Allows unauthenticated reads for specific settings like active match IDs (needed for login page).
    // Writes (e.g., changing active match) require authentication.
    match /app_settings/{settingId} {
      allow read: if true;
      allow write: if request.auth != null; // Typically, only admins should write here.
    }

    // Schedules (Tanding & TGR):
    // Only authenticated users (admins) can read and write schedules.
    match /schedules_tanding/{scheduleId} {
      allow read, write: if request.auth != null;
    }
    match /schedules_tgr/{scheduleId} {
      allow read, write: if request.auth != null;
    }

    // Tanding Matches & Subcollections:
    // All operations require authentication.
    match /matches_tanding/{matchId} {
      allow read, write: if request.auth != null;

      match /juri_scores/{juriId} {
        allow read, write: if request.auth != null;
      }
      match /official_actions/{actionId} {
        allow read, write: if request.auth != null;
      }
      match /verifications/{verificationId} {
        allow read, write: if request.auth != null;
      }
    }

    // TGR Matches & Subcollections:
    // All operations require authentication.
    match /matches_tgr/{matchId} {
      allow read, write: if request.auth != null;

      match /juri_scores_tgr/{juriId} {
        allow read, write: if request.auth != null;
      }
      match /dewan_penalties_tgr/{penaltyId} {
        allow read, write: if request.auth != null;
      }
      // If other TGR subcollections are added, they should follow this pattern.
    }

    // Default deny: By not having a broad "match /{document=**}" rule that allows access,
    // any path not explicitly matched above will be denied access by default.
    // This is a secure practice.
  }
}
