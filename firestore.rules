rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    /* ──────────────
       🔒 DEFAULT DENY
       ──────────────
       Aktifkan blok di bawah ini nanti
       supaya semua akses ditolak
       kecuali yang diizinkan eksplisit.
    ----------------------------------------------------------------
    match /{document=**} {
      allow read, write: if false;
    }
    ----------------------------------------------------------------*/

    /* ───────────────────────────────
       📁 1. app_settings (root)
       ─────────────────────────────── */
    match /app_settings/{settingId} {
      allow read : if true ;                // publik baca
      allow write: if true ;                // ⛔ ubah ke aturan admin
    }

    /* ───────────────────────────────
       📁 2. schedules (root)
       ─────────────────────────────── */
    match /schedules_tanding/{scheduleId} {
      allow read , write: if true ;         // ⛔ ubah ke aturan admin
    }
    match /schedules_tgr/{scheduleId} {
      allow read , write: if true ;         // ⛔ ubah ke aturan admin
    }

    /* ───────────────────────────────────────
       📁 3. matches_tanding (root → subkoleksi)
       ─────────────────────────────────────── */
    match /matches_tanding/{matchId} {

      /* Dokumen matchId itu sendiri */
      allow read , write: if true ;         // ⛔ kunci di produksi

      /* Subkoleksi juri_scores    → matches_tanding/{matchId}/juri_scores/{juriId} */
      match /juri_scores/{juriId} {
        allow read , write: if true ;       // ⛔ batasi ke juri terkait
      }

      /* Subkoleksi official_actions → matches_tanding/{matchId}/official_actions/{actionId} */
      match /official_actions/{actionId} {
        allow read , write: if true ;       // ⛔ batasi ke ketua
      }

      /* Subkoleksi verifications   → matches_tanding/{matchId}/verifications/{verificationId} */
      match /verifications/{verificationId} {
        allow read , write: if true ;       // ⛔ batasi sesuai peran
      }
    }

    /* ───────────────────────────────────────
       📁 4. matches_tgr (root → subkoleksi)
       ─────────────────────────────────────── */
    match /matches_tgr/{matchId} {

      allow read , write: if true ;         // ⛔ kunci di produksi

      match /juri_scores/{juriId} {
        allow read , write: if true ;       // ⛔ batasi ke juri terkait
      }
    }

    /* ───────────────────────────────
       📁 5. users (opsional contoh)
       ───────────────────────────────
    match /users/{userId} {
      allow read : if request.auth != null;                 // hanya user login
      allow write: if request.auth != null
                    && request.auth.uid == userId;          // hanya diri sendiri
    } */
  }
}
